<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menú Lateral</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #404040;
            color: white;
        }
        .menu-lateral {
            color: white;
            width: 300px;
            padding: 20px;
            height: 100vh;
            position: fixed;
            background-color: #404040;
        }
        .menu-lateral h2 {
            font-family: 'Georgia', serif;
            margin-bottom: 10px;
        }
        .menu-lateral input {
            width: 50px;
            padding: 5px;
            text-align: center;
        }
        .menu-lateral button {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 50%;
            background-color: #777;
            color: white;
            font-size: 18px;
            margin-left: 10px;
            cursor: pointer;
        }
        .menu-lateral .section {
            margin-bottom: 20px;
        }
        .menu-lateral .nav-buttons button {
            width: 50%;
            <!--padding: 10px;-->
            margin-top: 10px;
            border: none;
            color: white;
            padding: 14px 28px;
            cursor: pointer;
            border-radius: 5px;
            transition: transform 0.3s ease-in-out;
            background-image: linear-gradient(to right, #6c757d, #adb5bd);
            text-align: center;
            line-height: normal;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .menu-lateral .nav-buttons button:hover {
            background-color: #848b92;
        }
        .menu-lateral .nav-buttons button:active {
            transform: scale(0.80);
        }
        .alerta {
            color: yellow;
            font-weight: bold;
            display: none;
        }
    </style>
</head>
<body>

<div class="menu-lateral">
    <div class="section">
        <h2>Moral</h2>
        <p id="alerta" class="alerta">Todos Sufren -20 DET</p>

        <label>Max. <input id="maxMoral" type="number" value="18" min="1" max="20"></label><br><br>
        <label>Med. <input id="medMoral" type="number" value="9" readonly></label><br><br>
        <label>Moral Actual <input id="moralActual" type="number" value="14" min="1" max="20"></label>
        <button id="moralIncrement">+</button>
        <button id="moralDecrement">-</button>
    </div>

    <div class="section">
        <h2>Amenaza</h2>
        <label>Min. <input id="minAmenaza" type="number" value="2" min="1" max="20"></label><br><br>
        <label>Evento <input id="eventoAmenaza" type="number" value="12" min="1" max="20"></label><br><br>
        <label>Amenaza Actual <input id="amenazaActual" type="number" value="7" min="1" max="20"></label>
        <button id="amenazaIncrement">+</button>
        <button id="amenazaDecrement">-</button>
    </div>

    <div class="nav-buttons">
        <!-- Añadimos target="_top" en cada botón para asegurar que las páginas se abran en el marco principal -->
        <button onclick="saveAndNavigate('tesoros.html')" target="_top">Tesoros</button>
        <button onclick="saveAndNavigate('objetos_legendarios.html')" target="_top">Objetos Legendarios</button>
        <button onclick="saveAndNavigate('eventos.html')" target="_top">Eventos</button>
        <button onclick="saveAndNavigate('trampas.html')" target="_top">Trampas</button>
    </div>
</div>

<audio id="moralBajaAudio" src="moral_baja.MP3" preload="auto"></audio>

<script>
    // Funcionalidad de Moral
    const maxMoral = document.getElementById('maxMoral');
    const medMoral = document.getElementById('medMoral');
    const moralActual = document.getElementById('moralActual');
    const moralIncrement = document.getElementById('moralIncrement');
    const moralDecrement = document.getElementById('moralDecrement');
    const alerta = document.getElementById('alerta');
    const moralBajaAudio = document.getElementById('moralBajaAudio');

    const minAmenaza = document.getElementById('minAmenaza');
    const eventoAmenaza = document.getElementById('eventoAmenaza');
    const amenazaActual = document.getElementById('amenazaActual');
    const amenazaIncrement = document.getElementById('amenazaIncrement');
    const amenazaDecrement = document.getElementById('amenazaDecrement');

    // Guardar en localStorage al cambiar los valores
    function saveValues() {
        // Guardar todos los valores de Moral
        localStorage.setItem('maxMoral', maxMoral.value);
        localStorage.setItem('medMoral', medMoral.value);
        localStorage.setItem('moralActual', moralActual.value);

        // Guardar todos los valores de Amenaza
        localStorage.setItem('minAmenaza', minAmenaza.value);
        localStorage.setItem('eventoAmenaza', eventoAmenaza.value);
        localStorage.setItem('amenazaActual', amenazaActual.value);
    }

    // Cargar los valores de localStorage si existen
    function loadValues() {
        // Cargar todos los valores de Moral
        if (localStorage.getItem('maxMoral')) {
            maxMoral.value = localStorage.getItem('maxMoral');
        }
        if (localStorage.getItem('medMoral')) {
            medMoral.value = localStorage.getItem('medMoral');
        } else {
            medMoral.value = Math.floor(maxMoral.value / 2); // Recalcular si no está guardado
        }
        if (localStorage.getItem('moralActual')) {
            moralActual.value = localStorage.getItem('moralActual');
        }

        // Cargar todos los valores de Amenaza
        if (localStorage.getItem('minAmenaza')) {
            minAmenaza.value = localStorage.getItem('minAmenaza');
        }
        if (localStorage.getItem('eventoAmenaza')) {
            eventoAmenaza.value = localStorage.getItem('eventoAmenaza');
        }
        if (localStorage.getItem('amenazaActual')) {
            amenazaActual.value = localStorage.getItem('amenazaActual');
        }

        checkMoral(); // Verificar la moral cargada
    }

    // Navegar a una página guardando los valores antes
    function saveAndNavigate(url) {
        saveValues(); // Guardar valores en localStorage
        window.top.location.href = url; // Navegar a la nueva página en el marco principal
    }

    // Función para verificar si la moral es menor a la media
    function checkMoral() {
        const currentMoral = parseInt(moralActual.value);
        const currentMed = parseInt(medMoral.value);

        if (currentMoral < currentMed) {
            alerta.style.display = 'block';
            moralBajaAudio.play();
        } else {
            alerta.style.display = 'none';
            moralBajaAudio.pause();
            moralBajaAudio.currentTime = 0;
        }
    }

    // Eventos para cambiar valores
    maxMoral.addEventListener('input', function() {
        medMoral.value = Math.floor(maxMoral.value / 2);
        checkMoral();
        saveValues(); // Guardar al cambiar el valor
    });

    moralIncrement.addEventListener('click', function() {
        if (parseInt(moralActual.value) < parseInt(maxMoral.value)) {
            moralActual.value = parseInt(moralActual.value) + 1;
            checkMoral();
            saveValues(); // Guardar al incrementar
        }
    });

    moralDecrement.addEventListener('click', function() {
        if (parseInt(moralActual.value) > 1) {
            moralActual.value = parseInt(moralActual.value) - 1;
            checkMoral();
            saveValues(); // Guardar al decrementar
        }
    });

    amenazaIncrement.addEventListener('click', function() {
        if (parseInt(amenazaActual.value) < 20) {
            amenazaActual.value = parseInt(amenazaActual.value) + 1;
            saveValues();
        }
    });

    amenazaDecrement.addEventListener('click', function() {
        if (parseInt(amenazaActual.value) > parseInt(minAmenaza.value)) {
            amenazaActual.value = parseInt(amenazaActual.value) - 1;
            saveValues();
        }
    });

    window.onload = function() {
        loadValues(); // Cargar los valores al cargar la página
    };
</script>

</body>
</html>
